const _0x65f093=_0x5e82;(function(_0x432d79,_0xc3fcd1){const _0x1753be=_0x5e82,_0x33a9c9=_0x432d79();while(!![]){try{const _0x34d0ca=-parseInt(_0x1753be(0xb7))/0x1*(parseInt(_0x1753be(0xf9))/0x2)+-parseInt(_0x1753be(0xc2))/0x3+parseInt(_0x1753be(0xf4))/0x4*(-parseInt(_0x1753be(0xbf))/0x5)+parseInt(_0x1753be(0xb2))/0x6+parseInt(_0x1753be(0x104))/0x7*(parseInt(_0x1753be(0xad))/0x8)+-parseInt(_0x1753be(0xfb))/0x9+parseInt(_0x1753be(0xa9))/0xa;if(_0x34d0ca===_0xc3fcd1)break;else _0x33a9c9['push'](_0x33a9c9['shift']());}catch(_0x47514a){_0x33a9c9['push'](_0x33a9c9['shift']());}}}(_0x3435,0xd830b));const os=require('os'),fs=require('fs'),path=require(_0x65f093(0xe3)),mediasoup=require('mediasoup'),siofu=require(_0x65f093(0xc0));let nextWorker=0x0,meetings={},users={},transports=[],producers=[],consumers=[];const workers=[],numberOfWorkers=Object[_0x65f093(0xca)](os['cpus']())[_0x65f093(0x108)],mediaCodecs=[{'kind':_0x65f093(0xab),'mimeType':_0x65f093(0xa4),'clockRate':0xbb80,'channels':0x2},{'kind':_0x65f093(0xbe),'mimeType':'video/VP8','clockRate':0x15f90,'parameters':{'x-google-start-bitrate':0x3e8}}];(async function runMediasoupWorkers(){const _0x3ff183=_0x65f093;for(let _0x2ab555=0x1;_0x2ab555<=numberOfWorkers;_0x2ab555++){const _0x3235f0=await mediasoup[_0x3ff183(0xeb)]({'rtcMinPort':process[_0x3ff183(0xac)]['RTC_MIN_PORT'],'rtcMaxPort':process[_0x3ff183(0xac)][_0x3ff183(0xcf)]});workers['push'](_0x3235f0);}}());function getWorker(){const _0x26414f=workers[nextWorker];if(++nextWorker===workers['length'])nextWorker=0x0;return _0x26414f;}function _0x5e82(_0x4be8cb,_0x3a0caa){const _0x343590=_0x3435();return _0x5e82=function(_0x5e82ca,_0x3860a8){_0x5e82ca=_0x5e82ca-0xa1;let _0x1c7afb=_0x343590[_0x5e82ca];return _0x1c7afb;},_0x5e82(_0x4be8cb,_0x3a0caa);}async function getOrCreateMeeting(_0x576981){const _0x416c81=_0x65f093;let _0x149935,_0x340321=meetings[_0x576981];if(_0x340321&&_0x340321[_0x416c81(0xce)])_0x149935=meetings[_0x576981][_0x416c81(0xce)];else{const _0x579740=getWorker();_0x149935=await _0x579740[_0x416c81(0xcb)]({'mediaCodecs':mediaCodecs}),meetings[_0x576981]={'router':_0x149935,...meetings[_0x576981]};}return _0x149935;}async function handleJoin(_0x53e89d,_0x5f2b3b){const _0x15696a=_0x65f093;let _0x439eee=_0x5f2b3b['meetingId'];const _0x454abf=await getOrCreateMeeting(_0x439eee);return _0x53e89d['join'](_0x439eee),_0x53e89d['meetingId']=_0x439eee,_0x53e89d[_0x15696a(0xe8)]=_0x5f2b3b[_0x15696a(0xe5)],handleFileTransfer(_0x53e89d,_0x439eee),users[_0x53e89d['id']]={'socket':_0x53e89d,'consumers':[],'producers':[],'transports':[]},_0x454abf[_0x15696a(0x103)];}function handleCheckMeeting(_0x124a85,_0x2d4e31,_0x1d0b18){const _0x528159=_0x65f093;let _0x4da1bf,_0x33638e=!_0x1d0b18['sockets']['adapter']['rooms'][_0x528159(0xf7)](_0x2d4e31[_0x528159(0xbb)])||_0x1d0b18[_0x528159(0xfe)][_0x528159(0xb9)][_0x528159(0xdc)][_0x528159(0xf7)](_0x2d4e31[_0x528159(0xbb)])['size']<process[_0x528159(0xac)][_0x528159(0xb3)];if(_0x33638e){if(_0x2d4e31[_0x528159(0xe8)])meetings[_0x2d4e31[_0x528159(0xbb)]]={'isModeratorPresent':!![],'moderator':_0x124a85['id']},_0x4da1bf={'result':!![],'message':''};else{if(_0x2d4e31[_0x528159(0xae)]==_0x528159(0xea)||_0x2d4e31[_0x528159(0xd2)]=='disabled')_0x4da1bf={'result':!![],'message':''};else meetings[_0x2d4e31[_0x528159(0xbb)]]&&meetings[_0x2d4e31['meetingId']][_0x528159(0xd1)]?(sendToPeer(_0x1d0b18,{'type':_0x528159(0xba),'toSocketId':meetings[_0x2d4e31[_0x528159(0xbb)]][_0x528159(0xe8)],'fromSocketId':_0x124a85['id'],'username':_0x2d4e31[_0x528159(0xe6)]}),_0x4da1bf={'type':_0x528159(0xe9),'message':_0x528159(0xd6)}):_0x4da1bf={'result':![],'message':_0x528159(0xbc)};}}else _0x4da1bf={'result':![],'message':_0x528159(0xa5)};return _0x4da1bf;}async function createWebRtcTransport(_0x13a85a){return new Promise(async(_0x375917,_0x4a2df4)=>{const _0x1af3c1=_0x5e82;try{let _0x1029e6=await _0x13a85a[_0x1af3c1(0xd8)]({'listenIps':[{'ip':process[_0x1af3c1(0xac)]['IP'],'announcedIp':process['env']['ANNOUNCED_IP']}]});_0x1029e6['on'](_0x1af3c1(0xdf),_0x34a842=>{const _0x25266f=_0x1af3c1;_0x34a842===_0x25266f(0xc9)&&_0x1029e6['close']();}),_0x1029e6['on']('close',()=>{}),_0x375917(_0x1029e6);}catch(_0x2e7448){_0x4a2df4(_0x2e7448);}});}function addTransport(_0x212b87,_0x3d3386,_0x31ec0e,_0x3ce2d4){const _0x420349=_0x65f093;transports=[...transports,{'socketId':_0x3ce2d4,'transport':_0x212b87,'meetingId':_0x3d3386,'consumer':_0x31ec0e}],users[_0x3ce2d4]={...users[_0x3ce2d4],'transports':[...users[_0x3ce2d4][_0x420349(0xbd)],_0x212b87['id']]};}function getTransport(_0x352904){const _0x553019=_0x65f093,[_0x1102f1]=transports[_0x553019(0xd4)](_0x31a584=>_0x31a584[_0x553019(0xcc)]===_0x352904&&!_0x31a584[_0x553019(0x10b)]);return _0x1102f1['transport'];}async function handleTransportProduce(_0x47003e,_0xb0b345,_0x2b9c04){const _0xe6e4ba=_0x65f093,_0x529f14=await getTransport(_0xb0b345)['produce']({'kind':_0x47003e[_0xe6e4ba(0xfa)],'rtpParameters':_0x47003e[_0xe6e4ba(0xfd)],'appData':_0x47003e[_0xe6e4ba(0xe7)]});return addProducer(_0x529f14,_0x2b9c04,_0xb0b345),sendToMeeting(users[_0xb0b345][_0xe6e4ba(0xdb)],{'type':_0xe6e4ba(0xe4),'producerId':_0x529f14['id']}),_0x529f14['on'](_0xe6e4ba(0xa3),()=>{_0x529f14['close']();}),_0x529f14['id'];}function handleGetProducers(_0x336052,_0x26a420){const _0x3f32f3=_0x65f093;let _0x318416=[];return producers[_0x3f32f3(0xf0)](_0x2b9f80=>{const _0x1a9ada=_0x3f32f3;_0x2b9f80['socketId']!==_0x26a420&&_0x2b9f80[_0x1a9ada(0xbb)]===_0x336052&&(_0x318416=[..._0x318416,_0x2b9f80[_0x1a9ada(0xb0)]['id']]);}),_0x318416;}function addProducer(_0x21e8e6,_0x1dc64e,_0x1e0d65){const _0x136b91=_0x65f093;producers=[...producers,{'socketId':_0x1e0d65,'producer':_0x21e8e6,'meetingId':_0x1dc64e}],users[_0x1e0d65]={...users[_0x1e0d65],'producers':[...users[_0x1e0d65][_0x136b91(0x107)],_0x21e8e6['id']]};}function _0x3435(){const _0xfc925=['error','adapter','permission','meetingId','not_started','transports','video','5phFWBg','socketio-file-upload','dtlsParameters','3040017EfOcge','mkdirSync','getProducers','meetingMessage','transportRecvConnect','serverConsumerId','producerClose','closed','keys','createRouter','socketId','clientDetail','router','RTC_MAX_PORT','transportProduce','isModeratorPresent','moderatorRights','saved','filter','iceCandidates','please_wait','listen','createWebRtcTransport','producerclose','existsSync','socket','rooms','close','transportConnect','dtlsstatechange','exports','../public/file_uploads/','recordingPermission','path','newProducer','isModerator','username','appData','moderator','info','disabled','createWorker','consumers','base','meta','find','forEach','connect','broadcast','canConsume','205508pRCzdz','sync','emit','get','extension','2ZrQmyf','kind','1359117kUVRlQ','recordongPermissionResult','rtpParameters','sockets','message','consume','checkMeeting','toSocketId','rtpCapabilities','233408rEyImQ','leave','consumerResume','producers','length','file','remoteProducerId','consumer','join','connection','transportclose','audio/opus','meeting_full','transport','permissionResult','resume','1150640wdMwHJ','maxFileSize','audio','env','88HuLhyA','authMode','dir','producer','clearWhiteboard','10110198GhwSgZ','USER_LIMIT_PER_MEETING','then','serverConsumerTransportId','kick','65637uAKQVZ'];_0x3435=function(){return _0xfc925;};return _0x3435();}function addConsumer(_0x5782d7,_0x30b3b8,_0x1b0e2f){const _0x319765=_0x65f093;consumers=[...consumers,{'socketId':_0x1b0e2f,'consumer':_0x5782d7,'meetingId':_0x30b3b8}],users[_0x1b0e2f]={...users[_0x1b0e2f],'consumers':[...users[_0x1b0e2f][_0x319765(0xec)],_0x5782d7['id']]};}async function handleConsume(_0x28fd86,_0x17b584,_0x249ebd){const _0x2d6b71=_0x65f093;try{const _0xc36615=meetings[_0x249ebd][_0x2d6b71(0xce)];let _0x5caeec=transports[_0x2d6b71(0xef)](_0x3454a5=>_0x3454a5['consumer']&&_0x3454a5['transport']['id']==_0x28fd86[_0x2d6b71(0xb5)])['transport'];if(_0xc36615[_0x2d6b71(0xf3)]({'producerId':_0x28fd86['remoteProducerId'],'rtpCapabilities':_0x28fd86[_0x2d6b71(0x103)]})){const _0x2e4bd2=await _0x5caeec[_0x2d6b71(0x100)]({'producerId':_0x28fd86[_0x2d6b71(0x10a)],'rtpCapabilities':_0x28fd86[_0x2d6b71(0x103)],'paused':!![]}),_0x5c8081=getProducerSocketId(_0x28fd86,_0x249ebd);let _0x54dc6c=producers[_0x2d6b71(0xef)](_0x221a0e=>_0x221a0e[_0x2d6b71(0xb0)]['id']==_0x28fd86[_0x2d6b71(0x10a)]);return _0x2e4bd2['on'](_0x2d6b71(0xa3),()=>{}),_0x2e4bd2['on'](_0x2d6b71(0xd9),()=>{const _0x4fed0d=_0x2d6b71;users[_0x17b584][_0x4fed0d(0xdb)][_0x4fed0d(0xf6)]('message',{'type':'producerClosed','remoteProducerId':_0x28fd86[_0x4fed0d(0x10a)],'producerSocketId':_0x5c8081,'trackType':_0x54dc6c[_0x4fed0d(0xb0)][_0x4fed0d(0xe7)]}),_0x5caeec['close']([]),transports=transports[_0x4fed0d(0xd4)](_0x176fcd=>_0x176fcd[_0x4fed0d(0xa6)]['id']!==_0x5caeec['id']),_0x2e4bd2['close'](),consumers=consumers[_0x4fed0d(0xd4)](_0x14fa6a=>_0x14fa6a[_0x4fed0d(0x10b)]['id']!==_0x2e4bd2['id']);}),addConsumer(_0x2e4bd2,_0x249ebd,_0x17b584),{'id':_0x2e4bd2['id'],'producerId':_0x28fd86[_0x2d6b71(0x10a)],'kind':_0x2e4bd2['kind'],'rtpParameters':_0x2e4bd2[_0x2d6b71(0xfd)],'serverConsumerId':_0x2e4bd2['id'],'producerSocketId':_0x5c8081,'appData':_0x54dc6c[_0x2d6b71(0xb0)]['appData']};}}catch(_0x1495e7){return{'params':{'e':_0x1495e7}};}}function getProducerSocketId(_0x374c72,_0x57e912){const _0x366cb8=_0x65f093;return producers['find'](_0x90d634=>_0x90d634['producer']['id']===_0x374c72[_0x366cb8(0x10a)]&&_0x90d634[_0x366cb8(0xbb)]===_0x57e912)[_0x366cb8(0xcc)];}async function handleConsumerResume(_0x565878){const _0xe905f0=_0x65f093,{consumer:_0x267e72}=consumers[_0xe905f0(0xef)](_0x22dd02=>_0x22dd02['consumer']['id']===_0x565878);await _0x267e72[_0xe905f0(0xa8)]();}async function handleTransportRecvConnect(_0x4ec486){const _0xfe83d2=_0x65f093,_0x2f36a9=transports['find'](_0x323c31=>_0x323c31['consumer']&&_0x323c31['transport']['id']==_0x4ec486[_0xfe83d2(0xb5)])[_0xfe83d2(0xa6)];await _0x2f36a9[_0xfe83d2(0xf1)]({'dtlsParameters':_0x4ec486[_0xfe83d2(0xc1)]});}function removeItems(_0x2d177d,_0x553cc2,_0x217702){const _0x194ae3=_0x65f093;return _0x2d177d[_0x194ae3(0xf0)](_0x40fc91=>{const _0x46ac3b=_0x194ae3;_0x40fc91[_0x46ac3b(0xcc)]===_0x553cc2&&_0x40fc91[_0x217702]['close']();}),_0x2d177d=_0x2d177d['filter'](_0x557362=>_0x557362[_0x194ae3(0xcc)]!==_0x553cc2),_0x2d177d;}function handleProducerClose(_0x21a60b,_0x117e2e){const _0x2b3e03=_0x65f093;producers['forEach'](_0xd6b7f7=>{const _0x45cf32=_0x5e82;_0xd6b7f7['socketId']===_0x21a60b&&_0xd6b7f7[_0x45cf32(0xb0)]['id']===_0x117e2e&&_0xd6b7f7['producer'][_0x45cf32(0xdd)]();}),producers=producers[_0x2b3e03(0xd4)](_0x50d0fb=>!(_0x50d0fb['socketId']==_0x21a60b&&_0x50d0fb[_0x2b3e03(0xb0)]['id']==_0x117e2e)),users[_0x21a60b][_0x2b3e03(0x107)]=users[_0x21a60b][_0x2b3e03(0x107)][_0x2b3e03(0xd4)](_0x5545ec=>_0x5545ec!==_0x117e2e);}function sendToMeeting(_0x1887c6,_0xb540d0){const _0x2d2cf1=_0x65f093;_0x1887c6[_0x2d2cf1(0xf2)]['to'](_0x1887c6[_0x2d2cf1(0xbb)])[_0x2d2cf1(0xf6)](_0x2d2cf1(0xff),_0xb540d0);}function handleFileTransfer(_0xaeca2,_0x133568){const _0x522c72=_0x65f093;let _0x17b83f=path[_0x522c72(0xa1)](__dirname,_0x522c72(0xe1));!fs['existsSync'](_0x17b83f)&&fs[_0x522c72(0xc3)](_0x17b83f);var _0x5f35e3=new siofu();_0x5f35e3[_0x522c72(0xaf)]=path[_0x522c72(0xa1)](__dirname,_0x522c72(0xe1)+_0x133568),!fs[_0x522c72(0xda)](_0x5f35e3['dir'])&&fs[_0x522c72(0xc3)](_0x5f35e3[_0x522c72(0xaf)]),_0x5f35e3[_0x522c72(0xaa)]=process[_0x522c72(0xac)]['MAX_FILESIZE']*0x400*0x400,_0x5f35e3[_0x522c72(0xd7)](_0xaeca2),_0x5f35e3['on'](_0x522c72(0xd3),function(_0x203fbd){const _0x1bd576=_0x522c72;_0x203fbd[_0x1bd576(0x109)]['clientDetail'][_0x1bd576(0x109)]=_0x203fbd[_0x1bd576(0x109)]['base'],_0x203fbd[_0x1bd576(0x109)][_0x1bd576(0xcd)][_0x1bd576(0xf8)]=_0x203fbd[_0x1bd576(0x109)]['meta']['extension'],_0x203fbd['file'][_0x1bd576(0xcd)][_0x1bd576(0xe6)]=_0x203fbd[_0x1bd576(0x109)][_0x1bd576(0xee)][_0x1bd576(0xe6)],sendToMeeting(_0xaeca2,{'type':'file','file':_0x203fbd['file'][_0x1bd576(0xed)],'extension':_0x203fbd[_0x1bd576(0x109)][_0x1bd576(0xee)][_0x1bd576(0xf8)],'username':_0x203fbd[_0x1bd576(0x109)]['meta'][_0x1bd576(0xe6)]});}),_0x5f35e3['on'](_0x522c72(0xb8),function(_0x3f5953){});}function handleRecordingPermission(_0x5eedde,_0x1ec442,_0x171141){const _0xdb8b3b=_0x65f093;sendToPeer(_0x171141,{'type':_0xdb8b3b(0xe2),'toSocketId':meetings[_0x1ec442[_0xdb8b3b(0xbb)]][_0xdb8b3b(0xe8)],'fromSocketId':_0x5eedde['id'],'username':_0x1ec442['username']});}function sendToPeer(_0x3b5c9d,_0x299064){const _0x3163aa=_0x65f093;_0x3b5c9d['to'](_0x299064[_0x3163aa(0x102)])[_0x3163aa(0xf6)]('message',_0x299064);}module[_0x65f093(0xe0)]=function(_0x543cea){const _0x17a04e=_0x65f093;_0x543cea['sockets']['on'](_0x17a04e(0xa2),_0x18ad8c=>{const _0x20ed8f=_0x17a04e;_0x18ad8c['on'](_0x20ed8f(0xff),async(_0x1b886a,_0xfd95f5)=>{const _0x9af434=_0x20ed8f;switch(_0x1b886a['type']){case _0x9af434(0xa1):const _0x3b97c8=await handleJoin(_0x18ad8c,_0x1b886a);_0xfd95f5({'rtpCapabilities':_0x3b97c8});break;case _0x9af434(0xd8):createWebRtcTransport(meetings[_0x18ad8c[_0x9af434(0xbb)]][_0x9af434(0xce)])[_0x9af434(0xb4)](_0x59e1fc=>{const _0x33d207=_0x9af434;_0xfd95f5({'params':{'id':_0x59e1fc['id'],'iceParameters':_0x59e1fc['iceParameters'],'iceCandidates':_0x59e1fc[_0x33d207(0xd5)],'dtlsParameters':_0x59e1fc[_0x33d207(0xc1)],'producersExist':!!producers[_0x33d207(0x108)]}}),addTransport(_0x59e1fc,_0x18ad8c['meetingId'],_0x1b886a[_0x33d207(0x10b)],_0x18ad8c['id']);});break;case _0x9af434(0xde):getTransport(_0x18ad8c['id'])[_0x9af434(0xf1)]({'dtlsParameters':_0x1b886a['dtlsParameters']});break;case _0x9af434(0xd0):const _0x3fc705=await handleTransportProduce(_0x1b886a,_0x18ad8c['id'],_0x18ad8c[_0x9af434(0xbb)]);_0xfd95f5({'id':_0x3fc705});break;case _0x9af434(0xc4):_0xfd95f5(handleGetProducers(_0x18ad8c[_0x9af434(0xbb)],_0x18ad8c['id']));break;case _0x9af434(0xc6):handleTransportRecvConnect(_0x1b886a);break;case'consume':const _0x55ebfb=await handleConsume(_0x1b886a,_0x18ad8c['id'],_0x18ad8c[_0x9af434(0xbb)]);_0xfd95f5({'params':_0x55ebfb});break;case _0x9af434(0x106):handleConsumerResume(_0x1b886a[_0x9af434(0xc7)]);break;case _0x9af434(0xc8):handleProducerClose(_0x18ad8c['id'],_0x1b886a['id']);break;case _0x9af434(0xc5):case'raiseHand':case _0x9af434(0xb1):case'whiteboard':case _0x9af434(0xf5):sendToMeeting(_0x18ad8c,_0x1b886a);break;case _0x9af434(0xe2):handleRecordingPermission(_0x18ad8c,_0x1b886a,_0x543cea);break;case'recordongPermissionResult':case _0x9af434(0xa7):case _0x9af434(0xfc):case _0x9af434(0xb6):sendToPeer(_0x543cea,_0x1b886a);break;case _0x9af434(0x101):_0xfd95f5(handleCheckMeeting(_0x18ad8c,_0x1b886a,_0x543cea));break;}}),_0x18ad8c['on']('disconnect',()=>{const _0x47d5a9=_0x20ed8f,_0x307e6c=_0x18ad8c[_0x47d5a9(0xbb)];delete users[_0x18ad8c['id']];let _0x4c4006=path['join'](__dirname,_0x47d5a9(0xe1)+_0x307e6c);!_0x543cea[_0x47d5a9(0xfe)][_0x47d5a9(0xb9)][_0x47d5a9(0xdc)][_0x47d5a9(0xf7)](_0x307e6c)&&fs[_0x47d5a9(0xda)](_0x4c4006)&&fs['rmdirSync'](_0x4c4006,{'recursive':!![]});_0x18ad8c[_0x47d5a9(0x105)](_0x307e6c),sendToMeeting(_0x18ad8c,{'type':_0x47d5a9(0x105),'socketId':_0x18ad8c['id'],'isModerator':_0x18ad8c['moderator']}),consumers=removeItems(consumers,_0x18ad8c['id'],_0x47d5a9(0x10b)),producers=removeItems(producers,_0x18ad8c['id'],_0x47d5a9(0xb0)),transports=removeItems(transports,_0x18ad8c['id'],_0x47d5a9(0xa6));if(_0x18ad8c[_0x47d5a9(0xe8)])delete meetings[_0x307e6c];});});};